<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.9: http://docutils.sourceforge.net/" />
<title>Configuring Additional Hardware Keys</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7056 2011-06-17 10:50:48Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document" id="configuring-additional-hardware-keys">
<h1 class="title">Configuring Additional Hardware Keys</h1>

<!-- Copyright © 2013 Jim Turner <jturner314@gmail.com> -->
<div class="section" id="introduction">
<h1>Introduction</h1>
<p>Keys are identified on multiple levels in Linux: <em>scancode</em>, <em>keycode</em>, and
<em>keysym</em>. A <em>scancode</em> is the sequence of bytes that a keyboard sends to a
computer when a key is pressed. A <em>keycode</em> corresponds to a specific
function. A <em>keysym</em> corresponds to a symbol typed by the keyboard and mappings
of <em>scancodes</em> to <em>keysyms</em> depend on the keyboard layout. The progression of
mapping goes <em>scancode</em> → <em>keycode</em> → <em>keysym.</em> <a class="footnote-reference" href="#f1" id="id1">[1]</a> By default, some unusual
hardware keys, such as those on the bezels of some tablets, are not mapped. This
guide explains how to map <em>scancodes</em> to <em>keycodes</em> using the udev hwdb, which
is part of udev versions 196 and later.</p>
</div>
<div class="section" id="directions">
<h1>Directions</h1>
<div class="section" id="determine-the-scancodes-of-the-keys">
<h2>Determine the scancodes of the keys</h2>
<ol class="arabic">
<li><p class="first">Determine your Linux kernel version with:</p>
<pre class="literal-block">
$ uname -r
</pre>
</li>
<li><p class="first">For kernels v2.6 and later, you need reboot with the kernel parameter
<tt class="docutils literal">atkbd.softraw=0</tt> in order for the following step to work <a class="footnote-reference" href="#f1" id="id2">[1]</a>. Detailed
instructions on how to add kernel parameters are provided in <a class="footnote-reference" href="#f2" id="id3">[2]</a>.</p>
</li>
<li><p class="first">Switch to a virtual console with a text terminal with <tt class="docutils literal"><span class="pre">Ctrl-Alt-F2</span></tt>, login,
then run as root <a class="footnote-reference" href="#f1" id="id4">[1]</a>:</p>
<pre class="literal-block">
# showkey --scancodes
</pre>
<p>When you press a key, it should send the scancode to stdout. Sometimes,
pressing and releasing a key have two different scancodes, and both scancodes
will show up in the output of <tt class="docutils literal">showkey <span class="pre">--scancodes</span></tt>. For example, pressing
and releasing the screen rotation bezel key on the X220 tablet gives the
keycodes <tt class="docutils literal">0x67</tt> and <tt class="docutils literal">0xe7</tt>. Just choose the one that occurs when you
initially press the key. For the keys that you want to map, write down which
key corresponds to which scancode. Mappings for older ThinkPad tablets are
available at <a class="footnote-reference" href="#f6" id="id5">[3]</a>.</p>
</li>
<li><p class="first">You can switch back to your graphical environment with a key combination
somewhere between <tt class="docutils literal"><span class="pre">Ctrl-Alt-F1</span></tt> and <tt class="docutils literal"><span class="pre">Ctrl-Alt-F7</span></tt> and then reboot to
restore your default kernel parameters.</p>
</li>
</ol>
</div>
<div class="section" id="determine-which-keycodes-you-want-to-map-them-to">
<h2>Determine which keycodes you want to map them to</h2>
<ol class="arabic simple">
<li>Look in <tt class="docutils literal"><span class="pre">/lib/udev/hwdb.d/60-keyboard.hwdb</span></tt> for mappings of some other
ThinkPad models <a class="footnote-reference" href="#f3" id="id6">[4]</a>; these provide a guide for which key should correspond
to which keycode. (The mappings are up to you, but it's a good idea to pick
mappings similar to already established ones.)</li>
<li>A complete list of possible keycodes is in <tt class="docutils literal">/usr/include/linux/input.h</tt>
<a class="footnote-reference" href="#f3" id="id7">[4]</a>. Look for the definitions with the names <tt class="docutils literal">KEY_&lt;KEYCODE&gt;</tt>.</li>
</ol>
</div>
<div class="section" id="determine-the-modalias-string-of-your-keyboard">
<h2>Determine the modalias string of your keyboard</h2>
<ol class="arabic">
<li><p class="first">Use this command to list all of the modalias entries on your system <a class="footnote-reference" href="#f4" id="id8">[5]</a>:</p>
<pre class="literal-block">
$ find /sys -name modalias -print0 | xargs -0 cat | sort -u
</pre>
</li>
<li><p class="first">Determine the modalias string that corresponds to your keyboard. The relevant
one will probably start with <tt class="docutils literal">dmi</tt>. One example from an X220 tablet is:</p>
<pre class="literal-block">
dmi:bvnLENOVO:bvr8DET46WW(1.16):bd05/18/2011:svnLENOVO:pn42962WU:pvrThinkPadX220Tablet:rvnLENOVO:rn42962WU:rvrNotAvailable:cvnLENOVO:ct10:cvrNotAvailable:
</pre>
</li>
</ol>
</div>
<div class="section" id="write-and-install-a-udev-hwdb-configuration-file">
<h2>Write and install a udev hwdb configuration file</h2>
<ol class="arabic">
<li><p class="first">Create a hwdb file with the mappings that you want. Here is the file from
<tt class="docutils literal"><span class="pre">think-rotate</span></tt>, named <tt class="docutils literal"><span class="pre">90-X220T-keyboard.hwdb</span></tt>:</p>
<pre class="literal-block">
# Thinkpad X220_Tablet
keyboard:dmi:bvn*:bvr*:bd*:svnLENOVO*:pn*:pvrThinkPadX220Tablet*
KEYBOARD_KEY_67=cyclewindows                           # bezel circular arrow
KEYBOARD_KEY_6c=scale                                  # rotate screen
</pre>
<ul class="simple">
<li>Anything after a <tt class="docutils literal">#</tt> is a comment and is ignored.</li>
<li>The second line is a pattern that should match the modalias string of your
keyboard. This example matches the modalias string in the previous
section.</li>
<li>The following lines are the mappings. Each line is in the form
<tt class="docutils literal"><span class="pre">KEYBOARD_KEY_&lt;scancode&gt;=&lt;keycode&gt;</span></tt>. The <tt class="docutils literal">&lt;scancode&gt;</tt> should be the
value you obtained earlier without the <tt class="docutils literal">0x</tt> at the front, and the
<tt class="docutils literal">&lt;keycode&gt;</tt> should be the keycode you selected earlier but in all
lowercase.</li>
</ul>
</li>
<li><p class="first">Give the file an appropriate name, such as <tt class="docutils literal"><span class="pre">90-X220T-keyboard.hwdb</span></tt>, and
place it in <tt class="docutils literal">/lib/udev/hwdb.d/</tt>.</p>
</li>
</ol>
<p>See <a class="footnote-reference" href="#f3" id="id9">[4]</a> for more details.</p>
</div>
<div class="section" id="update-the-udev-hwdb">
<h2>Update the udev hwdb</h2>
<ol class="arabic">
<li><p class="first">Run the following to update the udev hwdb:</p>
<pre class="literal-block">
# udevadm hwdb --update
</pre>
</li>
<li><p class="first">You may need to reboot for the changes to take effect.</p>
</li>
</ol>
</div>
<div class="section" id="where-to-go-from-here">
<h2>Where to go from here</h2>
<ul class="simple">
<li>Now that you have properly mapped keycodes, you need to bind functionality to
them. You can do this with your desktop environment's settings manager.</li>
<li>Note that some keycodes may not be mapped to keysyms, so your desktop
environment may not recognize them. In this case, the easiest thing to do is
to choose a different keycode for that key. (This is what I did for the X220
screen rotation button in <tt class="docutils literal"><span class="pre">think-rotate</span></tt>: based on other ThinkPad models in
<tt class="docutils literal"><span class="pre">/lib/udev/hwdb.d/60-keyboard.hwdb</span></tt>, the <tt class="docutils literal">direction</tt> keycode would be the
better choice than <tt class="docutils literal">scale</tt>. However, <tt class="docutils literal">direction</tt> was not mapped in my
desktop environment, so it was easier just to choose a different keycode that
wasn't mapped to anything.) The alternative is to use a utility like xmodmap
to perform the mapping of keycode to keysym <a class="footnote-reference" href="#f5" id="id10">[6]</a>.</li>
<li>You can find some interesting tricks at this (somewhat out-of-date) page:
<a class="footnote-reference" href="#f7" id="id11">[7]</a>.</li>
</ul>
</div>
</div>
<div class="section" id="references">
<h1>References</h1>
<table class="docutils footnote" frame="void" id="f1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id2">2</a>, <a class="fn-backref" href="#id4">3</a>)</em> <a class="reference external" href="https://wiki.archlinux.org/index.php/Extra_Keyboard_Keys">https://wiki.archlinux.org/index.php/Extra_Keyboard_Keys</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[2]</a></td><td><a class="reference external" href="https://wiki.archlinux.org/index.php/Kernel_parameters">https://wiki.archlinux.org/index.php/Kernel_parameters</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[3]</a></td><td><a class="reference external" href="http://www.thinkwiki.org/wiki/Tablet_Hardware_Buttons">http://www.thinkwiki.org/wiki/Tablet_Hardware_Buttons</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[4]</td><td><em>(<a class="fn-backref" href="#id6">1</a>, <a class="fn-backref" href="#id7">2</a>, <a class="fn-backref" href="#id9">3</a>)</em> <a class="reference external" href="https://wiki.archlinux.org/index.php/Map_scancodes_to_keycodes">https://wiki.archlinux.org/index.php/Map_scancodes_to_keycodes</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id8">[5]</a></td><td><a class="reference external" href="http://people.skolelinux.org/pere/blog/Modalias_strings___a_practical_way_to_map__stuff__to_hardware.html">http://people.skolelinux.org/pere/blog/Modalias_strings___a_practical_way_to_map__stuff__to_hardware.html</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id10">[6]</a></td><td><a class="reference external" href="https://wiki.archlinux.org/index.php/Xmodmap">https://wiki.archlinux.org/index.php/Xmodmap</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id11">[7]</a></td><td><a class="reference external" href="http://www.thinkwiki.org/wiki/How_to_get_special_keys_to_work">http://www.thinkwiki.org/wiki/How_to_get_special_keys_to_work</a></td></tr>
</tbody>
</table>
</div>
</div>
</body>
</html>
